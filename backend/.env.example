# ============================================================================
# IFC-OpenWorld Backend Environment Configuration
# ============================================================================
# Copy this file to .env and update with your actual values
# DO NOT commit .env to version control!
#
# Quick Start: cp .env.example .env
# ============================================================================

# ----------------------------------------------------------------------------
# Server Configuration
# ----------------------------------------------------------------------------

# Server port (default: 3001)
PORT=3001

# Node environment: development | production | test
NODE_ENV=development

# Trust proxy (set to 1 if behind reverse proxy like nginx)
TRUST_PROXY=1

# ----------------------------------------------------------------------------
# Database Configuration (PostgreSQL + PostGIS)
# ----------------------------------------------------------------------------

# PostgreSQL connection URL
# Format: postgresql://[user[:password]@][host][:port][/dbname][?param1=value1&...]
#
# Docker Compose default:
DATABASE_URL=postgresql://ifc_user:ifc_password@localhost:5433/ifc_openworld

# Direct connection (if not using docker-compose):
# DATABASE_URL=postgresql://postgres:postgres@localhost:5432/ifc_openworld

# Connection pool settings
DB_POOL_MIN=2
DB_POOL_MAX=10
DB_POOL_IDLE_TIMEOUT=30000

# ----------------------------------------------------------------------------
# Redis Configuration (Caching)
# ----------------------------------------------------------------------------

# Redis connection URL
# Docker Compose default:
REDIS_URL=redis://localhost:6379

# Redis password (if required)
# REDIS_PASSWORD=your_redis_password

# Cache TTL in seconds (default: 300 = 5 minutes)
REDIS_CACHE_TTL=300

# ----------------------------------------------------------------------------
# S3/MinIO Configuration (File Storage)
# ----------------------------------------------------------------------------

# S3-compatible storage endpoint
# MinIO (Docker Compose): http://localhost:9000
# AWS S3: https://s3.amazonaws.com
AWS_ENDPOINT=http://localhost:9000

# S3 credentials
# MinIO defaults:
AWS_ACCESS_KEY_ID=minioadmin
AWS_SECRET_ACCESS_KEY=minioadmin

# For AWS S3, use your IAM credentials:
# AWS_ACCESS_KEY_ID=AKIAIOSFODNN7EXAMPLE
# AWS_SECRET_ACCESS_KEY=wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY

# S3 bucket name for IFC files
AWS_BUCKET_NAME=ifc-files

# AWS region
AWS_REGION=us-east-1

# Force path-style addressing for MinIO (set to false for AWS S3)
AWS_FORCE_PATH_STYLE=true

# Presigned URL expiration (seconds) - default: 900 (15 minutes)
S3_PRESIGNED_URL_EXPIRY=900

# ----------------------------------------------------------------------------
# Celery Configuration (IFC Processing Queue)
# ----------------------------------------------------------------------------

# Celery broker URL (Redis)
CELERY_BROKER_URL=redis://localhost:6379/0

# Celery result backend
CELERY_RESULT_BACKEND=redis://localhost:6379/0

# Task timeout (milliseconds) - default: 600000 (10 minutes)
CELERY_TASK_TIMEOUT=600000

# ----------------------------------------------------------------------------
# Security Configuration
# ----------------------------------------------------------------------------

# CORS allowed origins (comma-separated)
# Development:
CORS_ORIGINS=http://localhost:5173,http://localhost:3000

# Production (use your actual domain):
# CORS_ORIGINS=https://yourdomain.com,https://app.yourdomain.com

# CSRF secret (generate with: openssl rand -base64 32)
# IMPORTANT: Change this in production!
CSRF_SECRET=your-secret-key-min-32-chars-change-in-production

# Session secret (generate with: openssl rand -base64 32)
SESSION_SECRET=your-session-secret-change-in-production

# Rate limiting
RATE_LIMIT_ENABLED=true
RATE_LIMIT_WINDOW_MS=900000
RATE_LIMIT_MAX_REQUESTS=100

# ----------------------------------------------------------------------------
# File Upload Configuration
# ----------------------------------------------------------------------------

# Maximum file size in bytes (default: 104857600 = 100MB)
MAX_FILE_SIZE=104857600

# Allowed MIME types (comma-separated)
ALLOWED_MIME_TYPES=application/x-step,application/ifc,text/plain,application/octet-stream

# ClamAV antivirus configuration
CLAMAV_ENABLED=true
CLAMAV_HOST=localhost
CLAMAV_PORT=3310

# ----------------------------------------------------------------------------
# Logging Configuration
# ----------------------------------------------------------------------------

# Log level: error | warn | info | debug | verbose
LOG_LEVEL=info

# Log format: json | pretty
LOG_FORMAT=pretty

# Enable SQL query logging (verbose)
LOG_SQL_QUERIES=false

# ----------------------------------------------------------------------------
# Feature Flags
# ----------------------------------------------------------------------------

# Enable debug mode (extra logging)
DEBUG=false

# Enable API documentation (Swagger)
API_DOCS_ENABLED=true

# Enable health check endpoint
HEALTH_CHECK_ENABLED=true

# ----------------------------------------------------------------------------
# Monitoring & Analytics (Optional)
# ----------------------------------------------------------------------------

# Sentry DSN for error tracking (optional)
# SENTRY_DSN=https://examplePublicKey@o0.ingest.sentry.io/0

# New Relic license key (optional)
# NEW_RELIC_LICENSE_KEY=your_license_key

# ----------------------------------------------------------------------------
# Email Configuration (Optional - for notifications)
# ----------------------------------------------------------------------------

# SMTP settings
# SMTP_HOST=smtp.gmail.com
# SMTP_PORT=587
# SMTP_SECURE=false
# SMTP_USER=your-email@gmail.com
# SMTP_PASSWORD=your-app-password

# Email from address
# EMAIL_FROM=noreply@yourdomain.com

# ----------------------------------------------------------------------------
# Development & Testing
# ----------------------------------------------------------------------------

# Enable request logging in development
DEV_REQUEST_LOGGING=true

# Enable CORS for all origins in development (insecure!)
DEV_CORS_ALL=false

# Test database URL (for running tests)
# TEST_DATABASE_URL=postgresql://ifc_user:ifc_password@localhost:5433/ifc_openworld_test

# ----------------------------------------------------------------------------
# Production Optimizations
# ----------------------------------------------------------------------------

# Enable gzip compression
COMPRESSION_ENABLED=true

# Compression level (1-9, higher = more compression)
COMPRESSION_LEVEL=6

# Enable HTTP strict transport security
HSTS_ENABLED=true
HSTS_MAX_AGE=31536000

# Enable response caching
CACHE_ENABLED=true

# ----------------------------------------------------------------------------
# Advanced Configuration
# ----------------------------------------------------------------------------

# Database connection timeout (milliseconds)
DB_CONNECTION_TIMEOUT=5000

# Request timeout (milliseconds)
REQUEST_TIMEOUT=30000

# Body parser limit
BODY_PARSER_LIMIT=10mb

# JSON parser limit
JSON_PARSER_LIMIT=1mb

# URL encoded parser limit
URLENCODED_PARSER_LIMIT=1mb

# Keep-alive timeout (milliseconds)
KEEP_ALIVE_TIMEOUT=65000

# Headers timeout (milliseconds)
HEADERS_TIMEOUT=66000
